{% extends "base.html" %}

{% block title %}{{ fornitore.ragione_sociale }} - Dettaglio Fornitore{% endblock %}

{% block content %}
<div class="detail-container">
    <div class="detail-header">
        <h1 class="detail-title">
            <i class="fas fa-building"></i>
            {{ fornitore.ragione_sociale }}
        </h1>
        <div class="detail-actions">
            <a href="{{ url_for('fornitori.modifica_fornitore', id=fornitore.id) }}" class="btn btn-primary">
                <i class="fas fa-edit"></i> Modifica
            </a>
            <a href="{{ url_for('fornitori.index_fornitori') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Torna alla Lista
            </a>
        </div>
    </div>

    <div class="detail-grid">
        <!-- Informazioni Generali -->
        <div class="detail-panel">
            <h3><i class="fas fa-info-circle"></i> Informazioni Generali</h3>
            <div class="detail-content">
                <div class="detail-row">
                    <span class="detail-label">Ragione Sociale:</span>
                    <span class="detail-value highlight">{{ fornitore.ragione_sociale }}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Partita IVA:</span>
                    <span class="detail-value">{{ fornitore.partita_iva or 'N/D' }}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Codice Fiscale:</span>
                    <span class="detail-value">{{ fornitore.codice_fiscale or 'N/D' }}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Referente:</span>
                    <span class="detail-value">{{ fornitore.referente or 'N/D' }}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Stato:</span>
                    <span class="status-badge {% if fornitore.attivo %}status-attivo{% else %}status-inattivo{% endif %}">
                        {% if fornitore.attivo %}Attivo{% else %}Inattivo{% endif %}
                    </span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Nucleo:</span>
                    <span class="detail-value">{{ fornitore.nucleo }}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Data Registrazione:</span>
                    <span class="detail-value">{{ fornitore.data_creazione.strftime('%d/%m/%Y alle %H:%M') }}</span>
                </div>
            </div>
        </div>

        <!-- Indirizzo -->
        <div class="detail-panel">
            <h3><i class="fas fa-map-marker-alt"></i> Indirizzo</h3>
            <div class="detail-content">
                <div class="detail-row">
                    <span class="detail-label">Indirizzo:</span>
                    <span class="detail-value">{{ fornitore.indirizzo or 'N/D' }}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Città:</span>
                    <span class="detail-value highlight">{{ fornitore.citta }}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">CAP:</span>
                    <span class="detail-value">{{ fornitore.cap }}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Provincia:</span>
                    <span class="detail-value">{{ fornitore.provincia or 'N/D' }}</span>
                </div>
                {% if fornitore.indirizzo and fornitore.citta %}
                <div class="detail-row">
                    <span class="detail-label">Indirizzo Completo:</span>
                    <span class="detail-value">
                        {{ fornitore.indirizzo }}<br>
                        {{ fornitore.cap }} {{ fornitore.citta }}{% if fornitore.provincia %} ({{ fornitore.provincia }}){% endif %}
                    </span>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Contatti -->
        <div class="detail-panel">
            <h3><i class="fas fa-address-book"></i> Contatti</h3>
            <div class="detail-content">
                <div class="detail-row">
                    <span class="detail-label">Telefono Principale:</span>
                    <span class="detail-value">
                        {% if fornitore.telefono %}
                            <a href="tel:{{ fornitore.telefono }}" class="contact-link">
                                <i class="fas fa-phone"></i> {{ fornitore.telefono }}
                            </a>
                        {% else %}
                            N/D
                        {% endif %}
                    </span>
                </div>
                {% if fornitore.telefono_2 %}
                <div class="detail-row">
                    <span class="detail-label">Telefono 2:</span>
                    <span class="detail-value">
                        <a href="tel:{{ fornitore.telefono_2 }}" class="contact-link">
                            <i class="fas fa-phone"></i> {{ fornitore.telefono_2 }}
                        </a>
                    </span>
                </div>
                {% endif %}
                {% if fornitore.telefono_3 %}
                <div class="detail-row">
                    <span class="detail-label">Telefono 3:</span>
                    <span class="detail-value">
                        <a href="tel:{{ fornitore.telefono_3 }}" class="contact-link">
                            <i class="fas fa-phone"></i> {{ fornitore.telefono_3 }}
                        </a>
                    </span>
                </div>
                {% endif %}
                
                <div class="detail-row">
                    <span class="detail-label">Email Principale:</span>
                    <span class="detail-value">
                        {% if fornitore.email %}
                            <a href="mailto:{{ fornitore.email }}" class="contact-link">
                                <i class="fas fa-envelope"></i> {{ fornitore.email }}
                            </a>
                        {% else %}
                            N/D
                        {% endif %}
                    </span>
                </div>
                {% if fornitore.email_2 %}
                <div class="detail-row">
                    <span class="detail-label">Email 2:</span>
                    <span class="detail-value">
                        <a href="mailto:{{ fornitore.email_2 }}" class="contact-link">
                            <i class="fas fa-envelope"></i> {{ fornitore.email_2 }}
                        </a>
                    </span>
                </div>
                {% endif %}
                {% if fornitore.email_3 %}
                <div class="detail-row">
                    <span class="detail-label">Email 3:</span>
                    <span class="detail-value">
                        <a href="mailto:{{ fornitore.email_3 }}" class="contact-link">
                            <i class="fas fa-envelope"></i> {{ fornitore.email_3 }}
                        </a>
                    </span>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Settori di Attività -->
        <div class="detail-panel">
            <h3><i class="fas fa-tags"></i> Settori di Attività</h3>
            <div class="detail-content">
                {% if fornitore.settori_lista %}
                    <div class="settori-container">
                        {% for settore in fornitore.settori_lista %}
                            <span class="badge badge-settore">{{ settore }}</span>
                        {% endfor %}
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Settore Principale:</span>
                        <span class="detail-value">{{ fornitore.settore or 'N/D' }}</span>
                    </div>
                    {% if fornitore.settore_2 %}
                    <div class="detail-row">
                        <span class="detail-label">Settore 2:</span>
                        <span class="detail-value">{{ fornitore.settore_2 }}</span>
                    </div>
                    {% endif %}
                    {% if fornitore.settore_3 %}
                    <div class="detail-row">
                        <span class="detail-label">Settore 3:</span>
                        <span class="detail-value">{{ fornitore.settore_3 }}</span>
                    </div>
                    {% endif %}
                    {% if fornitore.settore_personalizzato %}
                    <div class="detail-row">
                        <span class="detail-label">Settore Personalizzato:</span>
                        <span class="detail-value">{{ fornitore.settore_personalizzato }}</span>
                    </div>
                    {% endif %}
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-tags"></i>
                        <p>Nessun settore specificato</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Note -->
        {% if fornitore.note %}
        <div class="detail-panel full-width">
            <h3><i class="fas fa-sticky-note"></i> Note</h3>
            <div class="detail-content">
                <p class="note-text">{{ fornitore.note }}</p>
            </div>
        </div>
        {% endif %}

        <!-- Manutenzioni Associate -->
        <div class="detail-panel full-width">
            <h3><i class="fas fa-tools"></i> Manutenzioni Effettuate</h3>
            <div class="detail-content">
                {% if fornitore.manutenzioni %}
                    <div class="maintenance-list">
                        {% for manutenzione in fornitore.manutenzioni|sort(attribute='data_intervento', reverse=true) %}
                        <div class="maintenance-item">
                            <div class="maintenance-info">
                                <div class="maintenance-type">{{ manutenzione.tipo_intervento }}</div>
                                <div class="maintenance-vehicle">
                                    <a href="{{ url_for('veicoli.dettaglio_veicolo', id=manutenzione.veicolo.id) }}" class="vehicle-link">
                                        {{ manutenzione.veicolo.targa }} - {{ manutenzione.veicolo.marca }} {{ manutenzione.veicolo.modello }}
                                    </a>
                                </div>
                            </div>
                            <div class="maintenance-details">
                                <div class="maintenance-date">{{ manutenzione.data_intervento.strftime('%d/%m/%Y') }}</div>
                                {% if manutenzione.costo %}
                                <div class="maintenance-cost">€{{ "%.2f"|format(manutenzione.costo) }}</div>
                                {% endif %}
                                <div class="maintenance-actions">
                                    <a href="{{ url_for('manutenzioni.dettaglio_manutenzione', id=manutenzione.id) }}" class="btn-action" title="Visualizza">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <div class="stats-summary">
                        <div class="stat-item">
                            <span class="stat-number">{{ fornitore.manutenzioni|length }}</span>
                            <span class="stat-label">Manutenzioni Totali</span>
                        </div>
                        {% set costo_totale = fornitore.manutenzioni|selectattr('costo')|map(attribute='costo')|sum %}
                        {% if costo_totale > 0 %}
                        <div class="stat-item">
                            <span class="stat-number">€{{ "%.2f"|format(costo_totale) }}</span>
                            <span class="stat-label">Fatturato Totale</span>
                        </div>
                        {% endif %}
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-tools"></i>
                        <p>Nessuna manutenzione effettuata</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Veicoli a Noleggio -->
        {% if fornitore.veicoli_noleggio %}
        <div class="detail-panel full-width">
            <h3><i class="fas fa-handshake"></i> Veicoli a Noleggio</h3>
            <div class="detail-content">
                <div class="veicoli-noleggio-list">
                    {% for veicolo in fornitore.veicoli_noleggio %}
                    <div class="veicolo-noleggio-item">
                        <div class="veicolo-info">
                            <div class="veicolo-targa">{{ veicolo.targa }}</div>
                            <div class="veicolo-details">{{ veicolo.marca }} {{ veicolo.modello }} ({{ veicolo.anno_immatricolazione }})</div>
                        </div>
                        <div class="veicolo-status">
                            <span class="status-badge status-{{ veicolo.stato.lower().replace(' ', '-') }}">
                                {{ veicolo.stato }}
                            </span>
                        </div>
                        <div class="veicolo-actions">
                            <a href="{{ url_for('veicoli.dettaglio_veicolo', id=veicolo.id) }}" class="btn-action" title="Visualizza">
                                <i class="fas fa-eye"></i>
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<style>
/* Stili specifici per dettaglio fornitori */
.contact-link {
    color: var(--matrix-green);
    text-decoration: none;
    transition: all 0.3s ease;
}

.contact-link:hover {
    color: var(--matrix-green-light);
    text-shadow: 0 0 5px var(--matrix-green);
}

.settori-container {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.vehicle-link {
    color: var(--matrix-green);
    text-decoration: none;
    font-weight: 500;
}

.vehicle-link:hover {
    color: var(--matrix-green-light);
    text-shadow: 0 0 5px var(--matrix-green);
}

.maintenance-list {
    space-y: 1rem;
}

.maintenance-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    background: var(--matrix-light-gray);
    border-radius: 8px;
    margin-bottom: 1rem;
    border-left: 4px solid var(--matrix-green);
}

.maintenance-type {
    font-weight: 500;
    color: var(--matrix-green);
    margin-bottom: 0.25rem;
}

.maintenance-vehicle {
    font-size: 0.9rem;
    color: var(--matrix-text-dim);
}

.maintenance-details {
    text-align: right;
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 0.25rem;
}

.maintenance-date {
    font-family: 'Orbitron', monospace;
    color: var(--matrix-text);
}

.maintenance-cost {
    font-weight: 500;
    color: var(--matrix-green);
}

.maintenance-actions {
    margin-top: 0.5rem;
}

.stats-summary {
    display: flex;
    justify-content: center;
    gap: 2rem;
    margin-top: 2rem;
    padding-top: 1rem;
    border-top: 1px solid var(--matrix-light-gray);
}

.stat-item {
    text-align: center;
}

.stat-number {
    display: block;
    font-family: 'Orbitron', monospace;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--matrix-green);
}

.stat-label {
    font-size: 0.9rem;
    color: var(--matrix-text-dim);
}

.veicoli-noleggio-list {
    space-y: 1rem;
}

.veicolo-noleggio-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    background: var(--matrix-light-gray);
    border-radius: 8px;
    margin-bottom: 1rem;
    border-left: 4px solid var(--matrix-warning);
}

.veicolo-targa {
    font-family: 'Orbitron', monospace;
    font-weight: 600;
    color: var(--matrix-green);
}

.veicolo-details {
    font-size: 0.9rem;
    color: var(--matrix-text-dim);
    margin-top: 0.25rem;
}

/* Responsive */
@media (max-width: 768px) {
    .maintenance-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .maintenance-details {
        align-items: flex-start;
        text-align: left;
    }
    
    .stats-summary {
        flex-direction: column;
        gap: 1rem;
    }
    
    .veicolo-noleggio-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }
}
</style>
{% endblock %}