{% extends "base.html" %}

{% block title %}Dashboard - Matrix Fleet Manager{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header">
        <h1 class="page-title">
            <i class="fas fa-tachometer-alt"></i>
            DASHBOARD SISTEMA
        </h1>
        <div class="system-status">
            <span class="status-indicator active"></span>
            <span>Sistema Operativo</span>
        </div>
    </div>

    <!-- Stats Cards (Solo quelle richieste) -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-car"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number">{{ stats.veicoli_attivi }}</div>
                <div class="stat-label">Veicoli Attivi</div>
                <div class="stat-sublabel">su {{ stats.totale_veicoli }} totali</div>
            </div>
            <div class="stat-trend up">
                <i class="fas fa-arrow-up"></i>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-building"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number">{{ stats.fornitori_attivi }}</div>
                <div class="stat-label">Fornitori Attivi</div>
                <div class="stat-sublabel">su {{ stats.totale_fornitori }} totali</div>
            </div>
            <div class="stat-trend stable">
                <i class="fas fa-minus"></i>
            </div>
        </div>

        <div class="stat-card warning">
            <div class="stat-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number">{{ stats.scadenze_urgenti }}</div>
                <div class="stat-label">Scadenze Urgenti</div>
                <div class="stat-sublabel">entro 30 giorni</div>
            </div>
            <div class="stat-trend down">
                <i class="fas fa-arrow-down"></i>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-tools"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number">{{ stats.totale_manutenzioni }}</div>
                <div class="stat-label">Manutenzioni</div>
                <div class="stat-sublabel">totali registrate</div>
            </div>
            <div class="stat-trend up">
                <i class="fas fa-arrow-up"></i>
            </div>
        </div>
    </div>

    <!-- Pannelli Principali -->
    <div class="dashboard-grid">
        <!-- Scadenze Urgenti -->
        <div class="dashboard-panel">
            <div class="panel-header">
                <h3><i class="fas fa-clock"></i> Scadenze Urgenti</h3>
                <a href="{{ url_for('scadenze.index_scadenze') }}" class="panel-link">
                    Visualizza Tutte <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            <div class="panel-content">
                {% if scadenze_urgenti %}
                    <div class="urgent-list">
                        {% for scadenza in scadenze_urgenti %}
                        <div class="urgent-item {% if scadenza.giorni_alla_scadenza <= 0 %}expired{% elif scadenza.giorni_alla_scadenza <= 7 %}critical{% endif %}">
                            <div class="urgent-info">
                                <div class="urgent-title">{{ scadenza.tipo_scadenza }}</div>
                                <div class="urgent-vehicle">{{ scadenza.veicolo.targa }} - {{ scadenza.veicolo.marca }} {{ scadenza.veicolo.modello }}</div>
                            </div>
                            <div class="urgent-date">
                                <div class="date">{{ scadenza.data_scadenza.strftime('%d/%m/%Y') }}</div>
                                <div class="days {% if scadenza.giorni_alla_scadenza <= 0 %}expired{% elif scadenza.giorni_alla_scadenza <= 7 %}critical{% endif %}">
                                    {% if scadenza.giorni_alla_scadenza <= 0 %}
                                        SCADUTA
                                    {% elif scadenza.giorni_alla_scadenza <= 7 %}
                                        {{ scadenza.giorni_alla_scadenza }} giorni
                                    {% else %}
                                        {{ scadenza.giorni_alla_scadenza }} giorni
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-check-circle"></i>
                        <p>Nessuna scadenza urgente</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Ultime Manutenzioni -->
        <div class="dashboard-panel">
            <div class="panel-header">
                <h3><i class="fas fa-tools"></i> Ultime Manutenzioni</h3>
                <a href="{{ url_for('manutenzioni.index_manutenzioni') }}" class="panel-link">
                    Visualizza Tutte <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            <div class="panel-content">
                {% if ultime_manutenzioni %}
                    <div class="maintenance-list">
                        {% for manutenzione in ultime_manutenzioni %}
                        <div class="maintenance-item">
                            <div class="maintenance-info">
                                <div class="maintenance-type">{{ manutenzione.tipo_intervento }}</div>
                                <div class="maintenance-vehicle">{{ manutenzione.veicolo.targa }} - {{ manutenzione.veicolo.marca }} {{ manutenzione.veicolo.modello }}</div>
                            </div>
                            <div class="maintenance-details">
                                <div class="maintenance-date">{{ manutenzione.data_intervento.strftime('%d/%m/%Y') }}</div>
                                {% if manutenzione.costo %}
                                <div class="maintenance-cost">â‚¬{{ "%.2f"|format(manutenzione.costo) }}</div>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-tools"></i>
                        <p>Nessuna manutenzione registrata</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}